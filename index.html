<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Cache Control for Development -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Ministry Registration</title>
    <link rel="stylesheet" href="styles.css?v=31&t=1739098800">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#007bff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Church Registration">
    
    <!-- PWA Icons for iOS -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Ministry Registration</h1>
                <div class="header-controls">
                    <select id="ministrySelector" class="ministry-selector" onchange="switchMinistry()" style="display: none;">
                        <option value="">Select Ministry...</option>
                    </select>
                    <!-- Configuration button commented out - OAuth and Master Config are now hard-coded in config.js -->
                    <!-- <button id="configBtn" class="config-btn" onclick="openConfiguration()" title="Settings & Configuration">
                        ‚öôÔ∏è
                    </button> -->
                </div>
            </div>
            <nav>
                <button class="nav-btn active" onclick="showSection('registration')">Registration</button>
                <button class="nav-btn" onclick="showSection('signin')">Sign In/Out</button>
                <button class="nav-btn" onclick="showSection('attendance')">Current Attendance</button>
                <!-- Manage Ministries tab hidden - ministries are managed directly in Master Config Google Sheet -->
                <!-- Section still accessible via showSection('ministries') if needed -->
                <!-- <button class="nav-btn" onclick="showSection('ministries')">Manage Ministries</button> -->
            </nav>
        </header>

        <!-- Google Sign Out Button -->
        <button id="googleSignOutBtn" class="btn btn-danger" style="position: absolute; left: 10px; top: 10px; z-index: 10;">Sign Out</button>

        <!-- Registration Section -->
        <section id="registration" class="section active">
            <h2>Parent & Child Registration</h2>
            
            <!-- Parent Registration Forms -->
            <div class="form-container">
                <h3>Parent/Guardian Information</h3>
                <div id="parentsContainer">
                    <!-- Parent forms will be added dynamically -->
                </div>
                <button type="button" id="addParentBtn" class="btn btn-secondary">Add Parent/Guardian</button>
            </div>

            <!-- Children Registration -->
            <div class="form-container">
                <h3>Children Information</h3>
                <div id="childrenContainer">
                    <!-- Children forms will be added dynamically -->
                </div>
                <button type="button" id="addChildBtn" class="btn btn-secondary">Add Child</button>
            </div>

            <!-- Disclaimer Agreement -->
            <div class="form-container">
                <h3>Important Information & Agreement</h3>
                <div class="disclaimer-text">
                    <p>It will be great to see your child join in the activities we have planned. In order for us to provide the best level of care while your child is under our supervision, we require that you fill out this registration page. This form only needs to be filled out once per family. The information provided will be treated confidentially within our team.</p>
                    
                    <p>I understand that although the leaders will take all reasonable care to ensure both the comfort and safety of my child, there is still a risk that an accident may occur.</p>
                </div>
                
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="disclaimerAgree" name="disclaimerAgree" required>
                        <span>I agree *</span>
                    </label>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" id="saveRegistrationBtn" class="btn btn-primary">Save Registration</button>
                <button type="button" id="clearFormBtn" class="btn btn-secondary">Clear Form</button>
            </div>
        </section>

        <!-- Sign In/Out Section -->
        <section id="signin" class="section">
            <h2>Sign In / Sign Out</h2>
            
            <div class="signin-container">
                <div class="form-group">
                    <label for="childSearch">Search for Child:</label>
                    <input type="text" id="childSearch" placeholder="Start typing child's name...">
                    <div id="childSuggestions" class="suggestions"></div>
                </div>
                
                <div id="selectedChildren" class="selected-children"></div>
                
                <div class="form-actions">
                    <button type="button" id="signInBtn" class="btn btn-success">Sign In Selected</button>
                    <button type="button" id="signOutBtn" class="btn btn-warning">Sign Out Selected</button>
                </div>
            </div>
        </section>

        <!-- Current Attendance Section -->
        <section id="attendance" class="section">
            <h2>Current Attendance - <span id="currentDate"></span></h2>
            
            <div class="attendance-controls">
                <button type="button" id="refreshAttendanceBtn" class="btn btn-primary">üîÑ Refresh View</button>
                <span id="attendanceCount" class="attendance-count">0 children signed in</span>
            </div>
            
            <div class="attendance-list">
                <table id="attendanceTable">
                    <thead>
                        <tr>
                            <th>Child Name</th>
                            <th>Parent Name</th>
                            <th>Parent Phone</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="attendanceTableBody">
                        <!-- Attendance records will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Ministry Management Section -->
        <section id="ministries" class="section">
            <h2>Manage Ministries</h2>
            
            <div class="form-container">
                <h3>Add Ministry</h3>
                <form id="addMinistryForm" onsubmit="addMinistry(event)">
                    <div class="form-group">
                        <label for="ministryName">Ministry Name *</label>
                        <input type="text" id="ministryName" name="ministryName" placeholder="e.g., Youth Ministry, Children's Church" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="ministrySheetUrl">Google Sheet URL *</label>
                        <input type="text" id="ministrySheetUrl" name="ministrySheetUrl" placeholder="Paste full Google Sheets URL" required>
                        <small>This sheet should have Parents, Children, and SignInOut tabs</small>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Add Ministry</button>
                </form>
            </div>

            <div class="form-container" style="margin-top: 30px;">
                <h3>Existing Ministries</h3>
                <div id="ministriesList" class="ministries-list">
                    <p>No ministries configured yet.</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Success/Error Messages -->
    <div id="messageContainer" class="message-container"></div>

    <!-- Scripts -->
    <script src="config.js?v=31&t=1739098800"></script>
    <script src="oauth.js?v=31&t=1739098800"></script>
    <script src="googleSheets.js?v=31&t=1739098800"></script>
    <script src="app.js?v=31&t=1739098800"></script>
</body>
</html>
